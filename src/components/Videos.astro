---
import type { Video } from "@/types/videos";
import VideoItem from "./organisms/VideoItem.astro";
import { getAllVideos } from "@/services/videos";

let videos: Video[] = [];
let errorMsg = "";
let debugUrl = "";

try {
  videos = await getAllVideos();
  errorMsg = videos.length > 0 ? "OK" : "Empty array returned";
  
  // Debug: mostrar qué URL se está usando
  const vercelUrl = import.meta.env.VERCEL_URL;
  if (typeof window === 'undefined' && vercelUrl) {
    debugUrl = `https://${vercelUrl}/api/videos/all.json`;
  } else {
    debugUrl = "Client-side or no VERCEL_URL";
  }
} catch (err) {
  errorMsg = `Error: ${err.message || err}`;
}
---
<section class="pb-16" id="videos">
  <div class="container mx-auto px-4">
    <!-- DEBUG -->
    <div style="color: yellow; background: red; padding: 10px; font-size: 16px; margin-bottom: 20px;">
      <p>Videos: {videos.length}</p>
      <p>Status: {errorMsg}</p>
      <p>VERCEL_URL: {import.meta.env.VERCEL_URL || "UNDEFINED"}</p>
      <p>Fetch URL: {debugUrl}</p>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      {videos.map((video: Video) => <VideoItem video={video} />)}
    </div>
  </div>
</section>
