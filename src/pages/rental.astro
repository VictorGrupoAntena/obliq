---
import Layout from "@/layouts/Layout.astro";
import Cta from "@/components/organisms/Cta.astro";
import Products from "@/components/Products.astro";
import { getI18N } from "@/a18n/index.ts";

const { currentLocale } = Astro;
const t = getI18N({ currentLocale: currentLocale ?? "es" });

const schema = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "name": "Obliq Productions",
  "url": "https://obliqproductions.com/rental",
  "telephone": "+34675489980",
  "email": "info@obliqproductions.com",
  "address": {
    "@type": "PostalAddress",
    "addressLocality": "Valencia",
    "addressRegion": "Comunidad Valenciana",
    "addressCountry": "ES"
  },
  "areaServed": [
    { "@type": "City", "name": "Valencia" },
    { "@type": "City", "name": "Alicante" },
    { "@type": "City", "name": "Castell√≥n" },
    { "@type": "AdministrativeArea", "name": "Comunidad Valenciana" }
  ],
  "hasOfferCatalog": {
    "@type": "OfferCatalog",
    "name": "Audiovisual Equipment Rental",
    "itemListElement": [
      { "@type": "OfferCatalog", "name": "Cameras" },
      { "@type": "OfferCatalog", "name": "Lighting" },
      { "@type": "OfferCatalog", "name": "Grip" }
    ]
  }
};
---

<Layout title={t.RENTAL.TITLE} pageTitle={t.RENTAL.PAGE_TITLE} description={t.RENTAL.META_DESCRIPTION} pageColor="white">
  <script type="application/ld+json" set:html={JSON.stringify(schema)} slot="head" />

  <section class="container mx-auto px-4 py-6 md:py-16">
    <h1
      class="text-5xl font-black leading-none text-balance italic uppercase"
      id="rental-title"
    >
      {t.RENTAL.TITLE}
    </h1>
    <p class="mt-4 max-w-3xl text-lg leading-relaxed text-gray-700" id="rental-description">
      {t.RENTAL.DESCRIPTION}
    </p>
  </section>

  <Products />
  <Cta title={t.RENTAL.CTA} long />
</Layout>

<script>
  import gsap from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";
  import { SplitText } from "gsap/SplitText";
  gsap.registerPlugin(ScrollTrigger, SplitText);

  function initProductAnimations() {
    const productItems = document.querySelectorAll(".product-item");
    const productSection = document.getElementById("products");
    const title = document.getElementById("rental-title");
    const description = document.getElementById("rental-description");

    const titleSplit = SplitText.create(title, { type: "lines" });

    gsap
      .timeline()
      .from(titleSplit.lines, {
        opacity: 0,
        y: 30,
        duration: 0.3,
        delay: 1,
        ease: "power2.out",
      })
      .from(description, {
        opacity: 0,
        y: 20,
        duration: 0.4,
        ease: "power2.out",
      });

    gsap.from(productItems, {
      opacity: 0,
      y: 100,
      duration: 0.2,
      ease: "power2.out",
      stagger: 0.1,
      scrollTrigger: {
        trigger: productSection,
        start: "-=200 center",
        end: "center -=300",
        toggleActions: "play reverse play reverse",
        scrub: 0.5,
      },
    });
  }

  document.addEventListener("DOMContentLoaded", initProductAnimations);
</script>
